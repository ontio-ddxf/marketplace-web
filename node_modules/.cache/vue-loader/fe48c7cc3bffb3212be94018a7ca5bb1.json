{"remainingRequest":"/Users/ericyang/Desktop/Onchina_item/marketplace-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/ericyang/Desktop/Onchina_item/marketplace-web/src/components/Buyer.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/ericyang/Desktop/Onchina_item/marketplace-web/src/components/Buyer.vue","mtime":1557385882058},{"path":"/Users/ericyang/Desktop/Onchina_item/marketplace-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/ericyang/Desktop/Onchina_item/marketplace-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/ericyang/Desktop/Onchina_item/marketplace-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/ericyang/Desktop/Onchina_item/marketplace-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { client } from 'ontology-dapi'\n\nexport default {\n  data() {\n    return {\n      tableData: [],\n      accountid: '',\n      orderCount: 0,\n      pageSize: 10,\n      pageNum: 1\n    }\n  },\n  methods: {\n    indexMethod(index) {\n      return (this.pageNum - 1) * this.pageSize + index + 1\n    },\n    async getBuyOrder() {\n      try {\n        let res = await this.$http.get(`http://192.168.50.96:10335/api/v1/data-dealer/tools/orders/0?ontid=did:ont:${this.accountid}&pageNum=${this.pageNum}&pageSize=${this.pageSize}`)\n        console.log(res)\n        if (res.status === 200 && res.data.msg === 'SUCCESS') {\n          this.tableData = res.data.result.list\n          this.orderCount = res.data.result.total\n        }\n      } catch (error) {\n        this.tableData = []\n      }\n\n    },\n    async cancelOrder(data) {   // 取消订单\n      console.log(data)\n      // 构造数据\n      let operation = 'cancelExchange'\n\n      // 构造args\n      let exchange_id = data.orderId\n      let args = [\n        {\n          type: 'ByteArray',\n          value: exchange_id\n        }\n      ]\n      let params = {\n        operation,\n        args\n\n      }\n\n      try {\n        const result = await this.$store.dispatch('dapiInvoke', params)\n        console.log(result)\n\n        if (result && result.transaction) {\n          this.getBuyOrder()\n          this.$message({\n            message: '取消成功！',\n            type: 'success',\n            center: true,\n            duration: 2000\n          });\n        } else {\n          this.$message({\n            message: '取消失败，请重试！',\n            type: 'error',\n            center: true,\n            duration: 2000\n          });\n        }\n\n      } catch (error) {\n        this.$message({\n          message: '取消失败，请重试！',\n          type: 'error',\n          center: true,\n          duration: 2000\n        });\n      }\n\n    },\n    async confirmReceipt(data) {   //  确认收货\n      console.log(data)\n      // 构造数据\n      let operation = 'receiveEncMessage'\n      // 构造args\n      let exchange_id = data.orderId\n      let args = [\n        {\n          type: 'ByteArray',\n          value: exchange_id\n        }\n      ]\n      let params = {\n        operation,\n        args\n      }\n\n      try {\n\n        const result = await this.$store.dispatch('dapiInvoke', params)\n        console.log(result)\n        if (result && result.transaction) {\n          this.getBuyOrder()\n          this.$message({\n            message: '收货成功！',\n            type: 'success',\n            center: true,\n            duration: 2000\n          });\n        } else {\n          this.$message({\n            message: '收货失败，请重试！',\n            type: 'error',\n            center: true,\n            duration: 2000\n          });\n        }\n      } catch (error) {\n        this.$message({\n          message: '收货失败，请重试！',\n          type: 'error',\n          center: true,\n          duration: 2000\n        });\n      }\n\n    },\n    handleCurrentChange(val) {\n      this.pageNum = val\n      this.getBuyOrder()\n    },\n    async viewInfo(data) {\n      try {\n        let res = await this.$http.get(`http://192.168.50.96:10335/api/v1/data-dealer/tools/data?orderId=${data.orderId}&ontid=did:ont:${this.accountid}`)\n        console.log('viewInfo', res)\n        if (res.status === 200 && res.data.msg === 'SUCCESS') {\n          this.openMsgBox(res.data.result[0])\n        } else {\n          this.$message({\n            message: '查看失败，请重试！',\n            type: 'error',\n            center: true,\n            duration: 2000\n          })\n        }\n      } catch (error) {\n        this.$message({\n          message: '查看失败，请重试！',\n          type: 'error',\n          center: true,\n          duration: 2000\n        })\n      }\n\n    },\n    openMsgBox(msg) {\n      this.$alert(msg, '商品信息', {\n        confirmButtonText: '确定',\n        callback: action => {\n        }\n      });\n    }\n  },\n  async mounted() {\n    this.accountid = await client.api.asset.getAccount()\n    console.log(this.accountid);\n    if (!this.accountid) {\n      return\n    }\n    this.getBuyOrder()\n  },\n}\n",{"version":3,"sources":["Buyer.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Buyer.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div>\n    <el-table border :data=\"tableData\" style=\"width: 100%\">\n      <el-table-column type=\"index\" :index=\"indexMethod\" align=\"center\"></el-table-column>\n      <el-table-column prop=\"dataProvider\" label=\"卖家\" style=\"width: 20%\" align=\"center\"></el-table-column>\n      <el-table-column prop=\"orderId\" label=\"订单号\" width=\"260\" align=\"center\"></el-table-column>\n      <el-table-column label=\"订单状态\" align=\"center\" width=\"180\">\n        <template slot-scope=\"scope\">\n          <el-tag size=\"medium\" v-if=\"scope.row.state === 'boughtOnchain'\">已下单</el-tag>\n          <el-tag\n            size=\"medium\"\n            type=\"success\"\n            v-else-if=\"scope.row.state === 'deliveredOnchain'\"\n          >已发货</el-tag>\n          <el-tag\n            size=\"medium\"\n            type=\"warning\"\n            v-else-if=\"scope.row.state === 'buyerRecvMsgOnchain'\"\n          >已收货</el-tag>\n          <el-tag\n            size=\"medium\"\n            type=\"danger\"\n            v-else-if=\"scope.row.state === 'sellerRecvTokenOnchain'\"\n          >卖家已收钱</el-tag>\n          <el-tag size=\"medium\" type=\"info\" v-else>订单已取消</el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"buyDate\" label=\"购买日期\" width=\"180\" align=\"center\"></el-table-column>\n      <el-table-column label=\"操作\" width=\"180\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <el-button\n            size=\"medium\"\n            type=\"success\"\n            v-if=\"scope.row.isRecvMsg === 0 && scope.row.state === 'deliveredOnchain'\"\n            @click=\"confirmReceipt(scope.row)\"\n          >确认收货</el-button>\n          <el-button\n            size=\"medium\"\n            type=\"success\"\n            v-else-if=\"scope.row.isRecvMsg === 0 && scope.row.state === 'sellerRecvTokenOnchain'\"\n            @click=\"confirmReceipt(scope.row)\"\n          >确认收货</el-button>\n          <el-tag size=\"medium\" type=\"info\" v-else-if=\"scope.row.isRecvMsg === 1\">订单已完成</el-tag>\n          <el-tag\n            size=\"medium\"\n            type=\"danger\"\n            v-else-if=\"scope.row.state === 'buyerCancelOnchain'\"\n          >订单已取消</el-tag>\n          <el-button @click=\"cancelOrder(scope.row)\" type=\"danger\" v-else>取消订单</el-button>\n          <el-button\n            style=\"margin-top: 6px;\"\n            @click=\"viewInfo(scope.row)\"\n            type=\"success\"\n            size=\"mini\"\n            v-show=\"scope.row.isRecvMsg === 1\"\n          >查看信息</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <div class=\"paginatio\">\n      <el-pagination\n        @current-change=\"handleCurrentChange\"\n        background\n        layout=\"prev, pager, next\"\n        :total=\"orderCount\"\n        :page-size=\"pageSize\"\n      ></el-pagination>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { client } from 'ontology-dapi'\n\nexport default {\n  data() {\n    return {\n      tableData: [],\n      accountid: '',\n      orderCount: 0,\n      pageSize: 10,\n      pageNum: 1\n    }\n  },\n  methods: {\n    indexMethod(index) {\n      return (this.pageNum - 1) * this.pageSize + index + 1\n    },\n    async getBuyOrder() {\n      try {\n        let res = await this.$http.get(`http://192.168.50.96:10335/api/v1/data-dealer/tools/orders/0?ontid=did:ont:${this.accountid}&pageNum=${this.pageNum}&pageSize=${this.pageSize}`)\n        console.log(res)\n        if (res.status === 200 && res.data.msg === 'SUCCESS') {\n          this.tableData = res.data.result.list\n          this.orderCount = res.data.result.total\n        }\n      } catch (error) {\n        this.tableData = []\n      }\n\n    },\n    async cancelOrder(data) {   // 取消订单\n      console.log(data)\n      // 构造数据\n      let operation = 'cancelExchange'\n\n      // 构造args\n      let exchange_id = data.orderId\n      let args = [\n        {\n          type: 'ByteArray',\n          value: exchange_id\n        }\n      ]\n      let params = {\n        operation,\n        args\n\n      }\n\n      try {\n        const result = await this.$store.dispatch('dapiInvoke', params)\n        console.log(result)\n\n        if (result && result.transaction) {\n          this.getBuyOrder()\n          this.$message({\n            message: '取消成功！',\n            type: 'success',\n            center: true,\n            duration: 2000\n          });\n        } else {\n          this.$message({\n            message: '取消失败，请重试！',\n            type: 'error',\n            center: true,\n            duration: 2000\n          });\n        }\n\n      } catch (error) {\n        this.$message({\n          message: '取消失败，请重试！',\n          type: 'error',\n          center: true,\n          duration: 2000\n        });\n      }\n\n    },\n    async confirmReceipt(data) {   //  确认收货\n      console.log(data)\n      // 构造数据\n      let operation = 'receiveEncMessage'\n      // 构造args\n      let exchange_id = data.orderId\n      let args = [\n        {\n          type: 'ByteArray',\n          value: exchange_id\n        }\n      ]\n      let params = {\n        operation,\n        args\n      }\n\n      try {\n\n        const result = await this.$store.dispatch('dapiInvoke', params)\n        console.log(result)\n        if (result && result.transaction) {\n          this.getBuyOrder()\n          this.$message({\n            message: '收货成功！',\n            type: 'success',\n            center: true,\n            duration: 2000\n          });\n        } else {\n          this.$message({\n            message: '收货失败，请重试！',\n            type: 'error',\n            center: true,\n            duration: 2000\n          });\n        }\n      } catch (error) {\n        this.$message({\n          message: '收货失败，请重试！',\n          type: 'error',\n          center: true,\n          duration: 2000\n        });\n      }\n\n    },\n    handleCurrentChange(val) {\n      this.pageNum = val\n      this.getBuyOrder()\n    },\n    async viewInfo(data) {\n      try {\n        let res = await this.$http.get(`http://192.168.50.96:10335/api/v1/data-dealer/tools/data?orderId=${data.orderId}&ontid=did:ont:${this.accountid}`)\n        console.log('viewInfo', res)\n        if (res.status === 200 && res.data.msg === 'SUCCESS') {\n          this.openMsgBox(res.data.result[0])\n        } else {\n          this.$message({\n            message: '查看失败，请重试！',\n            type: 'error',\n            center: true,\n            duration: 2000\n          })\n        }\n      } catch (error) {\n        this.$message({\n          message: '查看失败，请重试！',\n          type: 'error',\n          center: true,\n          duration: 2000\n        })\n      }\n\n    },\n    openMsgBox(msg) {\n      this.$alert(msg, '商品信息', {\n        confirmButtonText: '确定',\n        callback: action => {\n        }\n      });\n    }\n  },\n  async mounted() {\n    this.accountid = await client.api.asset.getAccount()\n    console.log(this.accountid);\n    if (!this.accountid) {\n      return\n    }\n    this.getBuyOrder()\n  },\n}\n</script>\n\n<style lang='less' scoped>\n.paginatio {\n  margin: 20px auto;\n}\n</style>\n"]}]}